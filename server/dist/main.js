(()=>{"use strict";var e={501:(e,r,t)=>{var n={};t.r(n);const a=require("@babel/runtime/helpers/classCallCheck");var s=t.n(a);const u=require("@babel/runtime/helpers/defineProperty");var i=t.n(u);const o=require("express");var c=t.n(o);const p=require("http"),l=require("body-parser");var d=t.n(l);const f=require("cors");var m=t.n(f);const g=require("joi");var v=t.n(g);const y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(r,t,n){if(e){var a=e.validate(r.body);if(a.error)return console.log(a.error),t.status(400).send(a.error.details?a.error.details:a.error)}n()}},h=require("mongoose");var b=t.n(h);const w=require("@babel/runtime/helpers/asyncToGenerator");var S=t.n(w);const O=require("@babel/runtime/regenerator");var x=t.n(O),U=v().object({userName:v().string().required(),firstName:v().string(),lastName:v().string(),email:v().string().required(),password:v().string().min(8).required(),phone:v().string(),gender:v().alternatives(["Male","Female"])}).unknown(!0);const q=require("bcrypt");var P=t.n(q),R=b().Schema,N=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/,j=new R({userName:{type:String,trim:!0,required:!0,index:!0},firstName:{type:String,min:[2,"First name should be at least 2 characters long"],required:!1},lastName:{type:String,min:[2,"Last name should be at least 2 characters long"],required:!1},email:{type:String,unique:!0,trim:!0,lowercase:!0,index:!0,validate:{validator:function(e){return N.test(e)},message:function(e){return"".concat(e.value," is not a valid email!")}},required:!0},phone:{type:String,unique:!1,validate:{validator:function(e){return/^[0-9]*$/.test(e)},message:function(e){return"".concat(e.value," is not a valid phone number!")}},required:!1},password:{type:String,trim:!0,min:[8,"Password should be at least 8 characters long"],required:!0},isActive:{type:Boolean,trim:!0,default:!0},recipes:[{type:b().ObjectId,ref:"User",default:[]}],gender:{type:String,trim:!0,default:null},createdAt:{type:Date,default:new Date}});j.virtual("fullName").get((function(){return this.firstName+" "+this.lastName})),j.statics.findByEmail=function(e){return this.find({email:e})},j.pre("save",(function(e){var r=this;if(!r.isModified("password"))return e();P().genSalt(10,(function(t,n){if(t)return e(t);P().hash(r.password,n,(function(t,n){if(t)return e(t);r.password=n,e()}))}))})),j.methods.comparePassword=function(e,r){P().compare(e,this.password,(function(e,t){if(e)return r(e);r(null,t)}))},b().model("user",j);var D=b().Schema,T=new D({userId:{type:b().ObjectId,ref:"User",required:!0},direction:{type:String,enum:["up","down"],required:!0}}),k=new D({userId:{type:b().ObjectId,ref:"User"},title:{type:String,min:[2,"Title should be at least 2 characters long"],required:!0},description:{type:String,min:[2,"Description should be at least 2 characters long"],required:!0},code:{type:String,min:[5,"Code should be at least 2 characters long"],required:!0},language:{type:String,min:[2,"Language should be at least 2 characters long"],required:!0},thumbs:{type:[T],default:[]},updatedAt:{type:Date},createdAt:{type:Date,default:new Date}});function E(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function _(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?E(Object(t),!0).forEach((function(r){i()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}k.statics.findByUserName=function(e){return this.find({userName:e})},k.post("save",function(){var e=S()(x().mark((function e(r){var t,n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,n=b().model("user"),e.next=4,n.findOne({_id:t.userId});case 4:if(!(a=e.sent)){e.next=10;break}return console.log("user was found. updating recipes"),a.recipes.push(t._id),e.next=10,a.save();case 10:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}()),k.post("deleteOne",{query:!0,document:!0},function(){var e=S()(x().mark((function e(r){var t,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,n=b().model("user"),console.log("@@@@@@@@@@@@@@@@@@ deleting recipe from user ",t._conditions._id),e.next=5,n.updateOne({userName:recipe.userName},{$pull:{recipes:t._conditions._id}});case 5:r();case 6:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}()),b().model("recipe",k);const A=function(){return{getAllUsers:function(){return new Promise(function(){var e=S()(x().mark((function e(r,t){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("inside getAllUsers"),e.next=4,n.User.find({});case 4:return a=e.sent,e.abrupt("return",r({status:200,payload:a}));case 8:e.prev=8,e.t0=e.catch(0),t({status:500,payload:e.t0});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r,t){return e.apply(this,arguments)}}())},getUserByUserName:function(e){return new Promise(function(){var r=S()(x().mark((function r(t,a){var s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.User.findOne({userName:e});case 3:return s=r.sent,r.abrupt("return",t({status:200,payload:s}));case 7:r.prev=7,r.t0=r.catch(0),a({status:500,payload:r.t0});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}())},getUserByEmail:function(e){return new Promise(function(){var r=S()(x().mark((function r(t,a){var s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.User.findOne({email:e});case 3:return s=r.sent,r.abrupt("return",t({status:200,payload:s}));case 7:r.prev=7,r.t0=r.catch(0),a({status:500,payload:r.t0});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}())},createUser:function(e){return new Promise(function(){var r=S()(x().mark((function r(t,a){var s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,console.log("inside createUser"),s=new n.User(_({},e)),r.next=5,s.save();case 5:return r.abrupt("return",t({status:200,payload:s}));case 8:r.prev=8,r.t0=r.catch(0),console.log(r.t0),a({status:500,payload:r.t0});case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e,t){return r.apply(this,arguments)}}())}}},I=require("apollo-server-express"),B=require("graphql"),C=require("subscriptions-transport-ws"),M=require("@graphql-tools/schema"),L=require("graphql-subscriptions");var F=A(),G=new L.PubSub;const $={query:{getUserByUserName:(J=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userName,e.next=3,F.getUserByUserName(n);case 3:return a=e.sent,e.abrupt("return",a.payload);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return J.apply(this,arguments)}),getUserByEmail:(H=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,e.next=3,F.getUserByEmail(n);case 3:return a=e.sent,e.abrupt("return",a.payload);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return H.apply(this,arguments)}),getAllUsers:(Q=S()(x().mark((function e(r,t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.name,e.next=3,F.getAllUsers();case 3:return n=e.sent,e.abrupt("return",n.payload);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return Q.apply(this,arguments)})},mutation:{createUser:(z=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.input,console.log("inside mutation"),e.next=4,F.createUser(n);case 4:return a=e.sent,G.publish("USER_CREATED",{userCreated:"user was created!"}),e.abrupt("return",a.payload);case 7:case"end":return e.stop()}}),e)}))),function(e,r){return z.apply(this,arguments)})},subscription:{userCreated:{subscribe:function(){return G.asyncIterator("USER_CREATED")}}}};var z,Q,H,J;const K=require("@babel/runtime/helpers/objectDestructuringEmpty");var V=t.n(K);const W=require("@babel/runtime/helpers/typeof");var X=t.n(W);function Y(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function Z(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Y(Object(t),!0).forEach((function(r){i()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Y(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var ee={getAllRecipes:function(){return new Promise(function(){var e=S()(x().mark((function e(r,t){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.Recipe.find({});case 3:return a=e.sent,e.abrupt("return",r({status:200,payload:a}));case 7:e.prev=7,e.t0=e.catch(0),t({status:500,payload:e.t0});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,t){return e.apply(this,arguments)}}())},getRecipesByUserName:function(e){return new Promise(function(){var r=S()(x().mark((function r(t,a){var s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.Recipe.find({userName:e});case 3:return s=r.sent,r.abrupt("return",t({status:200,payload:s}));case 7:r.prev=7,r.t0=r.catch(0),a({status:500,payload:r.t0});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}())},createRecipe:function(e){return new Promise(function(){var r=S()(x().mark((function r(t,a){var s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,s=new n.Recipe(Z({},e)),r.next=4,s.save();case 4:return r.abrupt("return",t({status:200,payload:s}));case 7:r.prev=7,r.t0=r.catch(0),console.log(r.t0),a({status:500,payload:r.t0});case 11:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}())},deleteRecipeById:function(e){return new Promise(function(){var r=S()(x().mark((function r(t,a){return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.Recipe.deleteOne({_id:e});case 3:return r.sent,r.abrupt("return",t({status:200,payload:e}));case 7:r.prev=7,r.t0=r.catch(0),a({status:500,payload:r.t0});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}())},addThumbUp:function(e){return new Promise(function(){var r=S()(x().mark((function r(t,a){var s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.Recipe.updateOne({_id:e},{$inc:{thumbsUp:1}});case 3:return s=r.sent,r.abrupt("return",t({status:200,payload:s}));case 7:r.prev=7,r.t0=r.catch(0),a({status:500,payload:r.t0});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}())},addThumbDown:function(e){return new Promise(function(){var r=S()(x().mark((function r(t,a){var s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.Recipe.updateOne({_id:e},{$inc:{thumbsUp:-1}});case 3:return s=r.sent,r.abrupt("return",t({status:200,payload:s}));case 7:r.prev=7,r.t0=r.catch(0),a({status:500,payload:r.t0});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}())}};console.log("*****   ",X()(ee));const re={query:{getAllRecipes:(ie=S()(x().mark((function e(r,t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V()(t),e.next=3,ee.getAllRecipes();case 3:return n=e.sent,e.abrupt("return",n.payload);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return ie.apply(this,arguments)}),getRecipesByUserName:(ue=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userName,e.next=3,ee.getRecipesByUserName(n);case 3:return a=e.sent,e.abrupt("return",a.payload);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return ue.apply(this,arguments)})},mutation:{createRecipe:(se=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.input,console.log("inside mutation"),e.next=4,ee.createRecipe(n);case 4:return a=e.sent,e.abrupt("return",a.payload);case 6:case"end":return e.stop()}}),e)}))),function(e,r){return se.apply(this,arguments)}),deleteRecipeById:(ae=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.next=3,ee.deleteRecipeById(n);case 3:return a=e.sent,e.abrupt("return",a.payload);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return ae.apply(this,arguments)}),addThumbUp:(ne=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.next=3,ee.addThumbUp(n);case 3:return a=e.sent,e.abrupt("return",a.payload);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return ne.apply(this,arguments)}),addThumbDown:(te=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.next=3,ee.addThumbDown(n);case 3:return a=e.sent,e.abrupt("return",a.payload);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return te.apply(this,arguments)})}};var te,ne,ae,se,ue,ie;function oe(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function ce(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?oe(Object(t),!0).forEach((function(r){i()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):oe(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}console.log($.mutation);const pe={Query:ce(ce({},$.query),re.query),Mutation:ce(ce({},$.mutation),re.mutation),Subscription:ce({},$.subscription)},le=require("@graphql-tools/merge"),de=require("@babel/runtime/helpers/taggedTemplateLiteral");var fe=t.n(de);const me=require("graphql-tag");var ge;const ve=t.n(me)()(ge||(ge=fe()(["\n\ntype User {\n    _id: String,\n    userName: String,\n    firstName: String,\n    fullName: String,\n    lastName: String,\n    email: String,\n    recipes: [Recipe],\n    phone: String,\n    isActive: Boolean,\n    gender: String,\n    createdAt: String,\n}\n\ntype Query {\n    getAllUsers: [User],\n    getUserByUserName(userName: String!): User\n    getUserByEmail(email: String!): User\n}\n\ntype Mutation {\n    createUser(input: CreateUserInput): User\n}\n\ninput CreateUserInput {\n    userName: String!, \n    firstName: String, \n    lastName: String, \n    email: String!, \n    phone: String, \n    password: String!, \n    gendr: String\n}\n"]))),ye=(0,le.mergeTypeDefs)(["\n    type Subscription{\n        userCreated: String\n    }\n"]),he=(0,le.mergeTypeDefs)([ve,"\nenum ThumbDirection {\n    up,\n    down\n  }\ntype Thumbs {\n    userId: String!,\n    direction: ThumbDirection!\n}\n\ntype Recipe {\n    _id: String,\n    language: String!,\n    title: String!,\n    description: String!,\n    code: String!,\n    thumbs: [Thumbs],\n    userId: String!,\n    createdAt: String,\n    updatedAt: String,\n}\n\ntype Query {\n    getAllRecipes: [Recipe],\n    getRecipesByUserName(userName: String!): [Recipe]\n}\n\ntype Mutation {\n    createRecipe(input: CreateRecipeInput): Recipe\n    deleteRecipeById(id: String!): String\n    addThumbUp(id: String!): Recipe\n    addThumbDown(id: String!): Recipe\n}\n\ninput CreateRecipeInput {\n    language: String!,\n    title: String!,\n    description: String!,\n    code: String!,\n    userId: String!,\n}\n",ye]);var be=function(){var e=S()(x().mark((function e(r,t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,M.makeExecutableSchema)({typeDefs:he,resolvers:pe}),a=new I.ApolloServer({schema:n}),e.next=4,a.start();case 4:return a.applyMiddleware({app:r,path:"/graphql"}),C.SubscriptionServer.create({schema:n,execute:B.execute,subscribe:B.subscribe},{server:t,path:a.graphqlPath}),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();t(334).config();var we=process.env.MONGO_CONNECTION_STRING;console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!   MONGO_CONNECTION_STRING ",we),b().Promise=global.Promise,(new function e(){var r=this;s()(this,e),i()(this,"initialize",(function(){var e=c()();b().connect(we,{useNewUrlParser:!0,useUnifiedTopology:!0}),e.use(d().urlencoded({limit:"50mb",extended:!0})),e.use(c().json()),e.use(m()({origin:function(e,r){return console.log("received call from origin:  ",e),r(null,!0)},optionsSuccessStatus:200,credentials:!0}));var t=c().Router();r.router=t,r.app=e,r.DEFAULT_PORT=process.env.PORT||4e3,r.httpServer=(0,p.createServer)(r.app)})),i()(this,"initRoutesMiddlewares",(function(){try{r.routesMiddlewares={validateRequest:y}}catch(e){console.log(e)}})),i()(this,"initRoutes",(function(){try{console.log("initalizing Routes "),function(e,r){try{!function(e,r,t){var n=t.validateRequest;e.get("/users/:userName",function(){var e=S()(x().mark((function e(t,n){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.getUserByUserName(t.params.userName);case 3:return a=e.sent,e.abrupt("return",n.status(a.status).send(a.payload));case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",n.status(500).send(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,t){return e.apply(this,arguments)}}()),e.post("/users",n(U),function(){var e=S()(x().mark((function e(t,n){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.createUser(t.body);case 3:return a=e.sent,e.abrupt("return",n.status(a.status).send(a.payload));case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",n.status(500).send(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,t){return e.apply(this,arguments)}}())}(e,A(),r)}catch(e){console.log(e)}}(r.app,r.routesMiddlewares)}catch(e){console.log(e)}})),i()(this,"listen",(function(e){r.httpServer.listen(r.DEFAULT_PORT,(function(){return e(r.DEFAULT_PORT)}))})),this.initialize(),this.initRoutesMiddlewares(),this.initRoutes(),this.apolloServer=be(this.app,this.httpServer)}).listen((function(e){console.log("Server is listening on port ".concat(e))}))},294:e=>{e.exports=require("babel-polyfill")},334:e=>{e.exports=require("dotenv")}},r={};function t(n){var a=r[n];if(void 0!==a)return a.exports;var s=r[n]={exports:{}};return e[n](s,s.exports,t),s.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(294),t(501)})();